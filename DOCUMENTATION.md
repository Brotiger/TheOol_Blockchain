# Проект платежной системы theool.net

## Из чего состоит проект

0. client - клиентская часть приложения отвечающая за регистрацию инвестора.
0. consensus - часть отвечающая за генерацию блоков блокчейн цепочки.
0. createUserVerefier - часть отвечающая за создание верификатора и автоматическую регистрацию его в бд в таблице верефикаторов.
0. dbDump - содержит в себе 2 дампа бд, дамп для бд с не верефицированными пользователями (db.sql) и дамп бд с верефецированными пользователями (ver_db.sql).
0. keyGenerator - часть отвечающая за генерацию пары публичного и приватного ключа, используется для генерации пары ключей для сервера верефикации.
0. ver_db - директория содержащая в себе скрипты отвечающие за автоматическое снятие дампов бд с верефецированными пользователями.
0. verificationServer - серверная часть приложения отвечающая за прием запросов (RestAPI) от различных типов клиентов (инвестор, верефикатор) их обработку и взаимосвязь с бд.
0. verifier - клиетская часть приложения для верефикатора, позволяющая верефикатору запросить список не верефицированных пользователей, запросить информацию о конкретном пользователе, верефецировать конкретного пользователя.
0. gitignore
0. docker-compose.yml - содержит в себе инструкцию по автоматической сборке и запуску контейнеров

## Важная информация

+ Каждая корневая директория содержит в себе корневой файл для той или иной части приложения с именем app.py.
+ Так же каждая директория содержащая в себе клиентский код имеет файл requirements.txt - это файл с зависимостями, перед запуском какого либо клиентского приложения необходимо установить зависимости из данного файла с помощью команды - ` pip3 install --no-cache-dir -r requirements.txt `.
+ Если вы запускаете серверную часть приложения не под linux, то вам так же понадобится объявить переменную окружения VER_SERVER_IP с IP адресом контейнера с verfificationServer, например: `export VER_SERVER_IP=<verfificationServer IP>`

## Теперь о каждой часть подробнее

### Директория client содержит в себе:
(Клиентская часть)
+ Директорию ciphers - содержащую в себе различные алгоритмы шифрование такие как AES и RSA. AES.py содержит в себе методы для шифрования и расшировки. RSA - содержит в себе методы для шифрования, расшифровки, подписи и проверки подписи.
+ Директорию components - содержащую в себе скрипт http.py отвечающий за обработку отправляемых и получаемых с сервера данных а именно их шифрования, расшифровку и проверку подписи.
+ Директория wallet в случае успешной регистрации инвестора на верефикацию содержит в себе публичный и приватный (зашифрованный с помощью алгоритма AES) ключ инвестора от кошелька.
+ Директорию keys куда должен быть помещен публичный ключ сервера сгенерированный с помощью ** keyGenerator **.
+ app.py - отвечает за прием данных от клиента.
+ requirements.txt - список зависимостей.

### Директория consensus содержит в себе:
(Серверная часть)
+ Директорию BlockChain - в которой имеет еще две поддиректории meta и block необходимые для хранения непосредственно самой блокчейн цепочке и мето информации о ней соответственно.
+ Директорию components содержащую в себе BlockChain.py - скрипт отвечающий за добавления данных в элемент блокчейн цепочки, генерацию блок, верефикацию блоков, поиск информации по блокам.
+ app.py - отвечает за поднятие сокет соединения и прием данных от ** verificationServer **.
+ Dockerfile - описывает конфигурацию контейнера для данного сервиса.

### Директория createUserVerifier содержит в себе:
(Клиентская часть)
+ Директорию ciphers - содержащую в себе различные алгоритмы шифрование такие как AES и RSA. AES.py содержит в себе методы для шифрования и расшировки. RSA - содержит в себе методы для шифрования, расшифровки, подписи и проверки подписи.
+ Директорию components - содержащую в себе скрипт http.py отвечающий за обработку отправляемых и получаемых с сервера данных а именно их шифрования, расшифровку и проверку подписи.
+ Директорию new_user - содержащую в себе данные вновь сгенерированного верефикатора. Которые при генерации верефикатора необходимо поместить в клиентское приложение верефикатора в директорию wallet.

### Директория dbDump содержит в себе:
(Данные для серверной части, для контейнеров db и ver_db)
+ db.sql - дамп бд для базы данных с не верефицированными инвесторами (контейнер db), после первого запуска verificationServer данный дамп необходимо развернуть в базе данных работающей в контейнере db
+ ver_db.sql - дамп бд для базы данных с верефицированными инвесторами (контейнер ver_db), после первого запуска verificationServer данный дамп необходимо развернуть в базе данных работающей в контейнере ver_db

### Директория keyGenerator содержит в себе:
(Клиентская часть)
+ Директория keys - будет содержать в себе пару ключей после их генерации.
+ app.py - скрипт отвечающих за генерацию и запись пары ключей.
+ requirements.txt - список зависимостей.

### Директория ver_db содержит в себе:
(Данные для серверной части, а именно для контейнера ver_db)
+ Директория data - будет содержать в себе дампы бд снятые автоматически с помощью shell скрипта
+ db_clone.sh - shell скрипт отвечающий за снятие дампа с бд верефицированных пользователей и удаление записей из данных таблиц
+ Dockerfile - описывает конфигурацию контейнера для данного сервиса.
+ root - инструкция для cron,  помещается в контейнер автоматически с помощью docker-compose.yml

### Директория verificationServer содержит в себе:
(Серверная часть)
+ Директорию ciphers - содержащую в себе различные алгоритмы шифрование такие как AES и RSA. AES.py содержит в себе методы для шифрования и расшировки. RSA - содержит в себе методы для шифрования, расшифровки, подписи и проверки подписи.
+ Директорию components - содержащую в себе скрипт http.py отвечающий за обработку отправляемых и получаемых с сервера данных а именно их шифрования, расшифровку и проверку подписи.
+ Директория config содержит в себе данные для подключение к db - connect_db.json и к ver_db - connect_ver_db.json.
+ Директория controllers - содержит в себе 2 контроллера userController и verifierController, данные контроллеры отвечают за обработку приходящих запросов, их валидацию, отчистку и перенаправление моделе для формирования запроса к БД
+ Директория keys должна содержать в себе приватный ключ сервера сгенерированный с помощью ** keyGenerator **.
+ Директория models содержит в себе необходимые модели (из MVS модели построения приложений) - скрипты (например Users.py) необходимые для формирования запросов к БД, а так же обработку возвращаемых ответов и передачу их обратно в контроллер
+ Директория validators содержит в себе скрипты validator и validator UserVerifier (подключаемые в контроллерах) в которых содержатся методы необходимые для проверки коректности переданных в них данных. Методы из данных скриптов проверяют тип передаваймых им значений, проверяют переданные значения по маскам, по длине, если передан файл то по структуре файла и возвращают результат True или False в зависимости от того прошло ли переданное значение валидацию
+ app.py - содержит в себе маршрутизатор для приходящих запросов написанный на фреймворке flask
+ Dockerfile - описывает конфигурацию контейнера для данного сервиса.
+ requirements.txt - список зависимостей (зависимости из данного файла устанавливаются в контейнер автоматически по средствам docker-compose).

### Директория verifier содержит в себе:
(Клиентская часть)
+ Директорию ciphers - содержащую в себе различные алгоритмы шифрование такие как AES и RSA. AES.py содержит в себе методы для шифрования и расшировки. RSA - содержит в себе методы для шифрования, расшифровки, подписи и проверки подписи.
+ Директорию components - содержащую в себе скрипт http.py отвечающий за обработку отправляемых и получаемых с сервера данных а именно их шифрования, расшифровку и проверку подписи.
+ Директорию keys куда должен быть помещен публичный ключ сервера сгенерированный с помощью ** keyGenerator **.
+ Директория wallet содержит в себе приватный, публичный ключ и id верефикатора, сгенерированные с помощью createUserVerifier
+ app.py - содердит в себе консольный интерфейс верификатора, отвечает за формирования запроса на получения списка не верефецированных инвесторов, получение информации о конкретном инвесторе, верефикацию инвестора
+ requirements.txt - список зависимостей.

## Запуск серверной части из под операционной системы Linux
(verificationServer)
Центром серверной части является контейнер verificationServer он распределяет запросы между другими контейнерами (такими как например consensus) и единолично взаимодействует с БД.
* Для повышения безопасности перед запуском контейнеров рекомендуется сменить пароли к БД для пользователя root (со стандартного 123123 на что то более сложное), сделать это можно через объявление переменных окружений на host машине с помощью следующих команд - ` export MYSQL_ROOT_PASSWORD=<new password> ` и ` export VER_MYSQL_ROOT_PASSWORD=<new password> ` соответственно *
0. Генерируем пару ключей для серверера, сгенерирированный приватный ключ кладем в директорию verificationServer/keys, публичный ключ сервера кладем в директории client/keys и verifier/keys
0. Запускаем все контейнеры с помощью ` docker-compose up `
0. Переносим дампы БД из директории ** dbDump ** в соответствующие БД через графический интерфейс adminer доступный по адресу 127.0.0.1:6080. По умолчанию пользователь root имеет пароль 123123 для обеих БД.
0. В БД db создаем пользователя server с паролем - v9bumEc1G9c8HBDO4QtHsFI8NNWcEh и в БД ver_db создаем пользователя с паролем - uitTbumEc1G912357sdf4QtHasFI8NNWcEh, оба пользователя должны быть доступны с адреса % и должны иметь полные права на любые дейстия в БД
(Если при попытке регистрации инвестора возвращается ответ {"seccess": False, "errors": None} значит сервер не может подключиться к базе данных - следовательно данный шаг вы сделали не правильно)
0. Заходим в контейнер c ver_db и запускаем cron для снятия дампа бд раз в сутки - ` service cron start `.

## Запуск клиентских приложений
(client, verifire, createUserVerifier и.т.п)
* Если запуск клиентских приложений будет производиться не из под операционной системы linux то необходимо объявить переменную окружения VER_SERVER_IP, например - * `export VER_SERVER_IP=<verfificationServer IP>`
+ Устанавлиаем зависимости с помощью следующей команды - ` pip3 install --no-cache-dir -r requirements.txt `
+ Запускаем клиентское приложение - `python3 app.py`